<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Market Economy Simulator V2 - Business simulation with production chains, real estate, and GAAP-compliant accounting">
    <title>Market Economy Simulator V2 | nhoffie.github.io</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Top Status Bar -->
        <div class="status-bar">
            <div>
                <span class="date-display">
                    Date: <span id="current-date">1.1.1</span>
                </span>
            </div>
            <div>
                <span class="cash-display">
                    Cash: <span id="current-cash">$0</span>
                </span>
            </div>
            <div class="controls">
                <button id="pause-btn" class="button button-primary">â–¶ Start</button>
                <button id="speed-btn" class="button">Speed: 1x</button>
                <button id="save-btn" class="button">ğŸ’¾ Save</button>
                <button id="load-btn" class="button">ğŸ“‚ Load</button>
                <button id="debug-btn" class="button">ğŸ› Debug</button>
            </div>
        </div>

        <!-- Main Layout: Sidebar + Content -->
        <div class="main-content">
            <!-- Sidebar Navigation -->
            <nav class="sidebar">
                <ul class="nav-menu">
                    <li class="nav-item active" data-view="dashboard">ğŸ“Š Dashboard</li>
                    <li class="nav-item" data-view="accounting">ğŸ’° Accounting</li>
                    <li class="nav-item" data-view="market">ğŸ“ˆ Market</li>
                    <li class="nav-item" data-view="production">ğŸ­ Production</li>
                    <li class="nav-item" data-view="real-estate">ğŸ¢ Real Estate</li>
                    <li class="nav-item" data-view="firm">ğŸ›ï¸ Firm Details</li>
                </ul>
                <div class="nav-footer">
                    <a href="../../index.html">â† Back to Home</a>
                </div>
            </nav>

            <!-- Content Area (Views rendered here) -->
            <main class="content-area">
                <!-- Dashboard View (default) -->
                <div id="dashboard-view" class="view active">
                    <h1>Dashboard</h1>

                    <div class="firm-summary">
                        <div class="firm-name">Your Company</div>
                        <div class="firm-info">
                            <div class="info-item">
                                <div class="info-label">Founded</div>
                                <div class="info-value">1.1.1</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Type</div>
                                <div class="info-value">User</div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-label">Cash</div>
                            <div class="stat-value">$0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Inventory</div>
                            <div class="stat-value">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Properties</div>
                            <div class="stat-value">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Production</div>
                            <div class="stat-value">0</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Phase 2: Accounting System Complete âœ…</h3>
                        </div>
                        <div class="card-body">
                            <p><strong>Phase 1 (Complete):</strong></p>
                            <ul>
                                <li>âœ… Core infrastructure (Event Bus, State Manager, Simulation Engine)</li>
                                <li>âœ… Utility modules (Date, Math, Validation)</li>
                                <li>âœ… Complete UI styling</li>
                                <li>âœ… Initial user firm in state</li>
                                <li>âœ… Debug mode enabled</li>
                            </ul>
                            <p class="mt-md"><strong>Phase 2 (Complete):</strong></p>
                            <ul>
                                <li>âœ… Chart of Accounts (35+ accounts)</li>
                                <li>âœ… Double-entry bookkeeping system</li>
                                <li>âœ… Journal (transaction audit trail)</li>
                                <li>âœ… Ledger (account balances)</li>
                                <li>âœ… Transaction Manager (validation & recording)</li>
                                <li>âœ… Financial Statements (Balance Sheet, Income Statement, Cash Flow)</li>
                                <li>âœ… Trial Balance reports</li>
                                <li>âœ… Sample transactions in console</li>
                            </ul>
                            <p class="mt-md"><strong>Next Steps:</strong></p>
                            <ul>
                                <li>Phase 3: Economy & Market (pricing, supply/demand)</li>
                                <li>Phase 4: Firms & Production (manufacturing chains)</li>
                                <li>Phase 5: Real Estate System</li>
                            </ul>
                            <p class="mt-md text-muted">
                                Open browser console (F12) to see accounting system demo and access <code>window.DEBUG</code>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Accounting View -->
                <div id="accounting-view" class="view">
                    <h1>Financial Statements</h1>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Accounting System Implemented âœ…</h3>
                        </div>
                        <div class="card-body">
                            <p><strong>Phase 2 Complete:</strong></p>
                            <ul>
                                <li>âœ… Double-entry bookkeeping with validation</li>
                                <li>âœ… Chart of Accounts (35+ accounts)</li>
                                <li>âœ… General Journal (chronological audit trail)</li>
                                <li>âœ… General Ledger (account balances)</li>
                                <li>âœ… Balance Sheet (financial position)</li>
                                <li>âœ… Income Statement (profitability)</li>
                                <li>âœ… Cash Flow Statement (cash flows)</li>
                                <li>âœ… Trial Balance (verification)</li>
                            </ul>
                            <p class="mt-md"><strong>How to Test:</strong></p>
                            <ol>
                                <li>Open browser console (F12)</li>
                                <li>View sample transactions and financial statements</li>
                                <li>Access accounting system via <code>window.DEBUG</code>:</li>
                            </ol>
                            <pre class="mt-sm" style="background: #f5f5f5; padding: 1rem; border-radius: 4px; overflow-x: auto;">
// Get transaction manager
const tx = window.DEBUG.txManager;

// Create a transaction
tx.recordOwnerInvestment(1000, 'Test investment',
    window.DEBUG.stateManager.getCurrentDate());

// View balance sheet
const bs = window.DEBUG.statements.generateBalanceSheet();
console.log(window.DEBUG.statements.formatBalanceSheet(bs));

// View income statement
const is = window.DEBUG.statements.generateIncomeStatement(
    {year: 1, month: 1, day: 1},
    {year: 1, month: 1, day: 28}
);
console.log(window.DEBUG.statements.formatIncomeStatement(is));
</pre>
                            <p class="mt-md text-muted">
                                <strong>Note:</strong> UI for viewing financial statements will be added in Phase 8 (UI Integration).
                                For now, all accounting functionality is accessible via the browser console.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Market View -->
                <div id="market-view" class="view">
                    <h1>Market</h1>
                    <div class="card">
                        <p>Market system will be implemented in Phase 3.</p>
                        <p>Features:</p>
                        <ul>
                            <li>Product prices</li>
                            <li>Supply & demand</li>
                            <li>Trading interface</li>
                            <li>Price history</li>
                        </ul>
                    </div>
                </div>

                <!-- Production View -->
                <div id="production-view" class="view">
                    <h1>Production</h1>
                    <div class="card">
                        <p>Production system will be implemented in Phase 4.</p>
                        <p>Features:</p>
                        <ul>
                            <li>Production chains</li>
                            <li>Manufacturing interface</li>
                            <li>Production capacity</li>
                            <li>Active production runs</li>
                        </ul>
                    </div>
                </div>

                <!-- Real Estate View -->
                <div id="real-estate-view" class="view">
                    <h1>Real Estate</h1>
                    <div class="card">
                        <p>Real estate system will be implemented in Phase 5.</p>
                        <p>Features:</p>
                        <ul>
                            <li>Property listings</li>
                            <li>Buy/sell properties</li>
                            <li>Production facilities</li>
                            <li>Property management</li>
                        </ul>
                    </div>
                </div>

                <!-- Firm Management View -->
                <div id="firm-view" class="view">
                    <h1>Firm Details</h1>
                    <div class="card">
                        <p>Firm management will be implemented in Phase 8.</p>
                        <p>Features:</p>
                        <ul>
                            <li>Firm overview</li>
                            <li>Inventory details</li>
                            <li>Property list</li>
                            <li>Financial summary</li>
                        </ul>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Module Imports (ES6) -->
    <script type="module">
        // Import core systems
        import { eventBus } from './core/event-bus.js';
        import { stateManager } from './core/state-manager.js';
        import { simulationEngine } from './core/simulation-engine.js';

        // Import utils
        import * as dateUtils from './utils/date-utils.js';
        import * as mathUtils from './utils/math-utils.js';
        import * as validation from './utils/validation.js';

        // Import accounting modules (Phase 2)
        import * as chartOfAccounts from './accounting/chart-of-accounts.js';
        import { Journal } from './accounting/journal.js';
        import { Ledger } from './accounting/ledger.js';
        import { TransactionManager } from './accounting/transaction-manager.js';
        import { FinancialStatements } from './accounting/financial-statements.js';

        // ===== Phase 1 & 2 Initialization =====
        console.log('ğŸš€ Market Economy Simulator V2 - Phases 1 & 2');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

        // Enable debug mode
        const debugMode = stateManager.isDebugMode();
        eventBus.setDebugMode(debugMode);
        stateManager.setDebugMode(debugMode);
        simulationEngine.setDebugMode(debugMode);

        console.log('âœ… Core systems loaded');
        console.log('âœ… Event Bus initialized');
        console.log('âœ… State Manager initialized');
        console.log('âœ… Simulation Engine initialized (stub)');
        console.log('âœ… Utility modules loaded');
        console.log('âœ… Accounting system initialized (Phase 2)');

        // Display initial state
        const state = stateManager.getState();
        console.log('ğŸ“Š Initial State:', state);

        const userFirm = stateManager.getUserFirm();
        console.log('ğŸ›ï¸ User Firm:', userFirm);

        // Test event bus
        eventBus.on('test:event', (data) => {
            console.log('ğŸ“¨ Test event received:', data);
        });
        eventBus.emit('test:event', { message: 'Event bus is working!' });

        // Test date utils
        const today = dateUtils.createDate(1, 1, 1);
        const tomorrow = dateUtils.addDays(today, 1);
        console.log('ğŸ“… Date test:', {
            today: dateUtils.formatDate(today),
            tomorrow: dateUtils.formatDate(tomorrow),
            daysBetween: dateUtils.daysBetween(today, tomorrow)
        });

        // Test math utils
        console.log('ğŸ”¢ Math test:', {
            currency: mathUtils.formatCurrency(1234.5678),
            percentage: mathUtils.formatPercentage(0.125),
            number: mathUtils.formatNumber(1234567.89, 2)
        });

        // Initialize simulation engine
        simulationEngine.init();

        // ===== Phase 2: Accounting System Demo =====
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        console.log('ğŸ’° Phase 2: Accounting System Demonstration');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

        // Get accounting objects for user firm
        const txManager = stateManager.getFirmTransactionManager('firm_user');
        const ledger = stateManager.getFirmLedger('firm_user');
        const journal = stateManager.getFirmJournal('firm_user');
        const statements = stateManager.getFirmFinancialStatements('firm_user');

        console.log('ğŸ“‹ Chart of Accounts:');
        console.log(`   Assets: ${chartOfAccounts.CHART_OF_ACCOUNTS.assets.length} accounts`);
        console.log(`   Liabilities: ${chartOfAccounts.CHART_OF_ACCOUNTS.liabilities.length} accounts`);
        console.log(`   Equity: ${chartOfAccounts.CHART_OF_ACCOUNTS.equity.length} accounts`);
        console.log(`   Revenue: ${chartOfAccounts.CHART_OF_ACCOUNTS.revenue.length} accounts`);
        console.log(`   Expenses: ${chartOfAccounts.CHART_OF_ACCOUNTS.expenses.length} accounts`);

        // Create sample transactions to demonstrate the system
        const currentDate = stateManager.getCurrentDate();

        console.log('\\nğŸ“ Creating sample transactions...');

        // Transaction 1: Owner investment (initial capital)
        const tx1 = txManager.recordOwnerInvestment(
            100000,
            'Initial capital investment',
            currentDate
        );
        console.log('âœ… Transaction 1: Owner invests $100,000 in cash');

        // Transaction 2: Purchase inventory (cash)
        const tx2 = txManager.recordCashPurchase(
            30000,
            'Inventory - Raw Materials',
            'Purchase raw materials for production',
            currentDate
        );
        console.log('âœ… Transaction 2: Purchase $30,000 of raw materials (cash)');

        // Transaction 3: Purchase equipment (cash)
        const tx3 = txManager.createSimpleTransaction(
            'Equipment',
            'Cash',
            20000,
            'Purchase manufacturing equipment',
            currentDate
        );
        console.log('âœ… Transaction 3: Purchase $20,000 of equipment (cash)');

        // Transaction 4: Cash sale
        const tx4 = txManager.recordCashSale(
            15000,
            5000,
            'Sale of finished goods',
            dateUtils.addDays(currentDate, 1)
        );
        console.log('âœ… Transaction 4: Cash sale $15,000 (COGS: $5,000)');

        // Transaction 5: Purchase on credit
        const tx5 = txManager.recordPurchase(
            10000,
            'Inventory - Raw Materials',
            'Purchase materials on credit',
            dateUtils.addDays(currentDate, 2)
        );
        console.log('âœ… Transaction 5: Purchase $10,000 materials on credit');

        // Display accounting reports
        console.log('\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        console.log('ğŸ“Š Financial Reports');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

        // Trial Balance
        const trialBalance = ledger.generateTrialBalance();
        console.log('\\nğŸ“‹ TRIAL BALANCE');
        console.log(ledger.formatTrialBalance(trialBalance));

        // Balance Sheet
        const balanceSheet = statements.generateBalanceSheet();
        console.log('\\nğŸ“Š BALANCE SHEET');
        console.log(statements.formatBalanceSheet(balanceSheet));

        // Income Statement
        const incomeStatement = statements.generateIncomeStatement(
            currentDate,
            dateUtils.addDays(currentDate, 2)
        );
        console.log('\\nğŸ’µ INCOME STATEMENT');
        console.log(statements.formatIncomeStatement(incomeStatement));

        console.log('\\nâœ… Accounting system fully functional!');
        console.log(`   Journal entries: ${journal.getEntryCount()}`);
        console.log(`   Trial balance: ${trialBalance.balanced ? 'âœ“ BALANCED' : 'âœ— OUT OF BALANCE'}`);
        console.log(`   Balance sheet: ${balanceSheet.balanced ? 'âœ“ BALANCED' : 'âœ— OUT OF BALANCE'}`);

        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        console.log('ğŸ’¡ Access debug tools via window.DEBUG');
        console.log('   Examples:');
        console.log('   - window.DEBUG.stateManager.getState()');
        console.log('   - window.DEBUG.dateUtils.formatDate({ year: 1, month: 5, day: 15 })');
        console.log('   - window.DEBUG.mathUtils.formatCurrency(123456)');
        console.log('   - window.DEBUG.eventBus.emit("test:event", { data: "test" })');

        // Make available globally for debugging
        window.DEBUG = {
            eventBus,
            stateManager,
            simulationEngine,
            dateUtils,
            mathUtils,
            validation,
            // Phase 2: Accounting
            chartOfAccounts,
            Journal,
            Ledger,
            TransactionManager,
            FinancialStatements,
            // User firm accounting shortcuts
            txManager,
            ledger,
            journal,
            statements
        };

        // ===== UI Event Handlers =====

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const viewName = item.getAttribute('data-view');

                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');

                // Show selected view
                document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
                document.getElementById(`${viewName}-view`).classList.add('active');

                console.log(`ğŸ“ Navigated to ${viewName} view`);
            });
        });

        // Pause/Play button
        const pauseBtn = document.getElementById('pause-btn');
        pauseBtn.addEventListener('click', () => {
            if (stateManager.isPaused()) {
                simulationEngine.start();
                pauseBtn.textContent = 'â¸ Pause';
                pauseBtn.classList.remove('button-primary');
                pauseBtn.classList.add('button-danger');
                console.log('â–¶ Simulation started');
            } else {
                simulationEngine.pause();
                pauseBtn.textContent = 'â–¶ Start';
                pauseBtn.classList.remove('button-danger');
                pauseBtn.classList.add('button-primary');
                console.log('â¸ Simulation paused');
            }
        });

        // Speed button (Phase 6: implement speed control)
        const speedBtn = document.getElementById('speed-btn');
        speedBtn.addEventListener('click', () => {
            console.log('âš ï¸ Speed control will be implemented in Phase 6');
        });

        // Save button (Phase 9: implement save functionality)
        const saveBtn = document.getElementById('save-btn');
        saveBtn.addEventListener('click', () => {
            const stateJson = stateManager.exportState();
            console.log('ğŸ’¾ Save game (Phase 9):');
            console.log('Save data (for now, just logged):');
            console.log(stateJson);
            alert('Save functionality will be implemented in Phase 9.\\nCheck console for state data.');
        });

        // Load button (Phase 9: implement load functionality)
        const loadBtn = document.getElementById('load-btn');
        loadBtn.addEventListener('click', () => {
            console.log('ğŸ“‚ Load game will be implemented in Phase 9');
            alert('Load functionality will be implemented in Phase 9.');
        });

        // Debug button (toggle debug mode)
        const debugBtn = document.getElementById('debug-btn');
        debugBtn.addEventListener('click', () => {
            const currentDebugMode = stateManager.isDebugMode();
            const newDebugMode = !currentDebugMode;

            stateManager.setDebugModeState(newDebugMode);
            eventBus.setDebugMode(newDebugMode);
            simulationEngine.setDebugMode(newDebugMode);

            debugBtn.classList.toggle('button-warning');
            console.log(`ğŸ› Debug mode ${newDebugMode ? 'ENABLED' : 'DISABLED'}`);
        });

        // Update UI with current state
        function updateUI() {
            const currentDate = stateManager.getCurrentDate();
            const userFirm = stateManager.getUserFirm();

            // Update date display
            document.getElementById('current-date').textContent = dateUtils.formatDate(currentDate);

            // Update cash display (will be from ledger in Phase 2)
            // For now, just show $0
            document.getElementById('current-cash').textContent = mathUtils.formatCurrency(0);
        }

        // Listen for time ticks to update UI
        eventBus.on('time:tick', () => {
            updateUI();
        });

        // Initial UI update
        updateUI();

        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        console.log('âœ… Phases 1 & 2 Complete - Application Ready!');
        console.log('âœ… Phase 1: Foundation - Core systems operational');
        console.log('âœ… Phase 2: Accounting - Double-entry bookkeeping functional');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    </script>
</body>
</html>
