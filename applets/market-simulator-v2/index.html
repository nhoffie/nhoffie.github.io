<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Market Economy Simulator V2 - Business simulation with production chains, real estate, and GAAP-compliant accounting">
    <title>Market Economy Simulator V2 | nhoffie.github.io</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Top Status Bar -->
        <div class="status-bar">
            <div>
                <span class="date-display">
                    Date: <span id="current-date">1.1.1</span>
                </span>
            </div>
            <div>
                <span class="cash-display">
                    Cash: <span id="current-cash">$0</span>
                </span>
            </div>
            <div class="controls">
                <button id="pause-btn" class="button button-primary">â–¶ Start</button>
                <button id="speed-btn" class="button">Speed: 1x</button>
                <button id="save-btn" class="button">ğŸ’¾ Save</button>
                <button id="load-btn" class="button">ğŸ“‚ Load</button>
                <button id="debug-btn" class="button">ğŸ› Debug</button>
            </div>
        </div>

        <!-- Main Layout: Sidebar + Content -->
        <div class="main-content">
            <!-- Sidebar Navigation -->
            <nav class="sidebar">
                <ul class="nav-menu">
                    <li class="nav-item active" data-view="dashboard">ğŸ“Š Dashboard</li>
                    <li class="nav-item" data-view="accounting">ğŸ’° Accounting</li>
                    <li class="nav-item" data-view="market">ğŸ“ˆ Market</li>
                    <li class="nav-item" data-view="production">ğŸ­ Production</li>
                    <li class="nav-item" data-view="real-estate">ğŸ¢ Real Estate</li>
                    <li class="nav-item" data-view="firm">ğŸ›ï¸ Firm Details</li>
                </ul>
                <div class="nav-footer">
                    <a href="../../index.html">â† Back to Home</a>
                </div>
            </nav>

            <!-- Content Area (Views rendered here) -->
            <main class="content-area">
                <!-- Dashboard View (default) -->
                <div id="dashboard-view" class="view active">
                    <h1>Dashboard</h1>

                    <div class="firm-summary">
                        <div class="firm-name">Your Company</div>
                        <div class="firm-info">
                            <div class="info-item">
                                <div class="info-label">Founded</div>
                                <div class="info-value">1.1.1</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Type</div>
                                <div class="info-value">User</div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-label">Cash</div>
                            <div class="stat-value">$0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Inventory</div>
                            <div class="stat-value">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Properties</div>
                            <div class="stat-value">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Production</div>
                            <div class="stat-value">0</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Phase 1: Foundation Complete âœ…</h3>
                        </div>
                        <div class="card-body">
                            <p><strong>Implemented:</strong></p>
                            <ul>
                                <li>âœ… Core infrastructure (Event Bus, State Manager, Simulation Engine)</li>
                                <li>âœ… Utility modules (Date, Math, Validation)</li>
                                <li>âœ… Complete UI styling</li>
                                <li>âœ… Initial user firm in state</li>
                                <li>âœ… Debug mode enabled</li>
                                <li>âœ… All 28 module files created</li>
                            </ul>
                            <p class="mt-md"><strong>Next Steps:</strong></p>
                            <ul>
                                <li>Phase 2: Accounting System (double-entry bookkeeping)</li>
                                <li>Phase 3: Economy & Market</li>
                                <li>Phase 4: Firms & Production</li>
                            </ul>
                            <p class="mt-md text-muted">
                                Open browser console (F12) to test utilities via <code>window.DEBUG</code>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Accounting View -->
                <div id="accounting-view" class="view">
                    <h1>Financial Statements</h1>
                    <div class="card">
                        <p>Accounting system will be implemented in Phase 2.</p>
                        <p>Features:</p>
                        <ul>
                            <li>Double-entry bookkeeping</li>
                            <li>Balance Sheet</li>
                            <li>Income Statement</li>
                            <li>Cash Flow Statement</li>
                            <li>Transaction journal</li>
                        </ul>
                    </div>
                </div>

                <!-- Market View -->
                <div id="market-view" class="view">
                    <h1>Market</h1>
                    <div class="card">
                        <p>Market system will be implemented in Phase 3.</p>
                        <p>Features:</p>
                        <ul>
                            <li>Product prices</li>
                            <li>Supply & demand</li>
                            <li>Trading interface</li>
                            <li>Price history</li>
                        </ul>
                    </div>
                </div>

                <!-- Production View -->
                <div id="production-view" class="view">
                    <h1>Production</h1>
                    <div class="card">
                        <p>Production system will be implemented in Phase 4.</p>
                        <p>Features:</p>
                        <ul>
                            <li>Production chains</li>
                            <li>Manufacturing interface</li>
                            <li>Production capacity</li>
                            <li>Active production runs</li>
                        </ul>
                    </div>
                </div>

                <!-- Real Estate View -->
                <div id="real-estate-view" class="view">
                    <h1>Real Estate</h1>
                    <div class="card">
                        <p>Real estate system will be implemented in Phase 5.</p>
                        <p>Features:</p>
                        <ul>
                            <li>Property listings</li>
                            <li>Buy/sell properties</li>
                            <li>Production facilities</li>
                            <li>Property management</li>
                        </ul>
                    </div>
                </div>

                <!-- Firm Management View -->
                <div id="firm-view" class="view">
                    <h1>Firm Details</h1>
                    <div class="card">
                        <p>Firm management will be implemented in Phase 8.</p>
                        <p>Features:</p>
                        <ul>
                            <li>Firm overview</li>
                            <li>Inventory details</li>
                            <li>Property list</li>
                            <li>Financial summary</li>
                        </ul>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Module Imports (ES6) -->
    <script type="module">
        // Import core systems
        import { eventBus } from './core/event-bus.js';
        import { stateManager } from './core/state-manager.js';
        import { simulationEngine } from './core/simulation-engine.js';

        // Import utils
        import * as dateUtils from './utils/date-utils.js';
        import * as mathUtils from './utils/math-utils.js';
        import * as validation from './utils/validation.js';

        // ===== Phase 1 Initialization =====
        console.log('ğŸš€ Market Economy Simulator V2 - Phase 1 Foundation');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

        // Enable debug mode
        const debugMode = stateManager.isDebugMode();
        eventBus.setDebugMode(debugMode);
        stateManager.setDebugMode(debugMode);
        simulationEngine.setDebugMode(debugMode);

        console.log('âœ… Core systems loaded');
        console.log('âœ… Event Bus initialized');
        console.log('âœ… State Manager initialized');
        console.log('âœ… Simulation Engine initialized (stub)');
        console.log('âœ… Utility modules loaded');

        // Display initial state
        const state = stateManager.getState();
        console.log('ğŸ“Š Initial State:', state);

        const userFirm = stateManager.getUserFirm();
        console.log('ğŸ›ï¸ User Firm:', userFirm);

        // Test event bus
        eventBus.on('test:event', (data) => {
            console.log('ğŸ“¨ Test event received:', data);
        });
        eventBus.emit('test:event', { message: 'Event bus is working!' });

        // Test date utils
        const today = dateUtils.createDate(1, 1, 1);
        const tomorrow = dateUtils.addDays(today, 1);
        console.log('ğŸ“… Date test:', {
            today: dateUtils.formatDate(today),
            tomorrow: dateUtils.formatDate(tomorrow),
            daysBetween: dateUtils.daysBetween(today, tomorrow)
        });

        // Test math utils
        console.log('ğŸ”¢ Math test:', {
            currency: mathUtils.formatCurrency(1234.5678),
            percentage: mathUtils.formatPercentage(0.125),
            number: mathUtils.formatNumber(1234567.89, 2)
        });

        // Initialize simulation engine
        simulationEngine.init();

        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        console.log('ğŸ’¡ Access debug tools via window.DEBUG');
        console.log('   Examples:');
        console.log('   - window.DEBUG.stateManager.getState()');
        console.log('   - window.DEBUG.dateUtils.formatDate({ year: 1, month: 5, day: 15 })');
        console.log('   - window.DEBUG.mathUtils.formatCurrency(123456)');
        console.log('   - window.DEBUG.eventBus.emit("test:event", { data: "test" })');

        // Make available globally for debugging
        window.DEBUG = {
            eventBus,
            stateManager,
            simulationEngine,
            dateUtils,
            mathUtils,
            validation
        };

        // ===== UI Event Handlers =====

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const viewName = item.getAttribute('data-view');

                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');

                // Show selected view
                document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
                document.getElementById(`${viewName}-view`).classList.add('active');

                console.log(`ğŸ“ Navigated to ${viewName} view`);
            });
        });

        // Pause/Play button
        const pauseBtn = document.getElementById('pause-btn');
        pauseBtn.addEventListener('click', () => {
            if (stateManager.isPaused()) {
                simulationEngine.start();
                pauseBtn.textContent = 'â¸ Pause';
                pauseBtn.classList.remove('button-primary');
                pauseBtn.classList.add('button-danger');
                console.log('â–¶ Simulation started');
            } else {
                simulationEngine.pause();
                pauseBtn.textContent = 'â–¶ Start';
                pauseBtn.classList.remove('button-danger');
                pauseBtn.classList.add('button-primary');
                console.log('â¸ Simulation paused');
            }
        });

        // Speed button (Phase 6: implement speed control)
        const speedBtn = document.getElementById('speed-btn');
        speedBtn.addEventListener('click', () => {
            console.log('âš ï¸ Speed control will be implemented in Phase 6');
        });

        // Save button (Phase 9: implement save functionality)
        const saveBtn = document.getElementById('save-btn');
        saveBtn.addEventListener('click', () => {
            const stateJson = stateManager.exportState();
            console.log('ğŸ’¾ Save game (Phase 9):');
            console.log('Save data (for now, just logged):');
            console.log(stateJson);
            alert('Save functionality will be implemented in Phase 9.\\nCheck console for state data.');
        });

        // Load button (Phase 9: implement load functionality)
        const loadBtn = document.getElementById('load-btn');
        loadBtn.addEventListener('click', () => {
            console.log('ğŸ“‚ Load game will be implemented in Phase 9');
            alert('Load functionality will be implemented in Phase 9.');
        });

        // Debug button (toggle debug mode)
        const debugBtn = document.getElementById('debug-btn');
        debugBtn.addEventListener('click', () => {
            const currentDebugMode = stateManager.isDebugMode();
            const newDebugMode = !currentDebugMode;

            stateManager.setDebugModeState(newDebugMode);
            eventBus.setDebugMode(newDebugMode);
            simulationEngine.setDebugMode(newDebugMode);

            debugBtn.classList.toggle('button-warning');
            console.log(`ğŸ› Debug mode ${newDebugMode ? 'ENABLED' : 'DISABLED'}`);
        });

        // Update UI with current state
        function updateUI() {
            const currentDate = stateManager.getCurrentDate();
            const userFirm = stateManager.getUserFirm();

            // Update date display
            document.getElementById('current-date').textContent = dateUtils.formatDate(currentDate);

            // Update cash display (will be from ledger in Phase 2)
            // For now, just show $0
            document.getElementById('current-cash').textContent = mathUtils.formatCurrency(0);
        }

        // Listen for time ticks to update UI
        eventBus.on('time:tick', () => {
            updateUI();
        });

        // Initial UI update
        updateUI();

        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        console.log('âœ… Phase 1 Complete - Application Ready!');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    </script>
</body>
</html>
